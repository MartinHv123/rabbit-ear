let fold = {
	"file_spec":1.1,
	"file_creator":"Rabbit Ear",
	"file_author":"",
	"file_title":"",
	"file_description":"",
	"file_classes":[],
	"file_frames":[{
		"vertices_coords":[
			[-0.077629326515743,0.222365599934443],
			[0.868727413223969,0.35623308695382],
			[1.092762829727165,0.069513263977397],
			[0.555215403053198,0.020416103605051],
			[0.98521128251713,0.250392299429831],
			[0,0.189054449978441],
			[-0.051914534279177,0.189838470961913],
			[0.885245284274817,0.259586741716081],
			[1.090744971380565,0.149837317651563],
			[0.057569265531226,0.236881190632472],
			[0.981333474338653,0.066713994710695],
			[0.065999964048386,0.313344679845428],
			[0,0.280584808487959],
			[0.970190854651827,0.073475740634178],
			[-0.010712955168508,0.275267305088694],
			[0.804785164004061,0.173849915280079],
			[0.85794245005983,0.141592145348655],
			[-0.06062832942005,0.250491212210194],
			[0.613852942012142,0.440942421821759],
			[0.345937774994248,0.452295159696518],
			[0.53979048230003,0.444080772296018],
			[0.628932667007193,0.440303427893204],
			[0.345937774994249,0.452295159696519],
			[0.345937774994247,0.452295159696518],
			[0.539790482300032,0.444080772296018],
			[0.802235102940144,0.432959845407362],
			[0.345937774994248,0.452295159696518]
		],
		"frame_classes":["foldedForm"],
		"frame_inherit":true,
		"frame_parent":0,
		"faces_re:matrix":[[0.7117743142018731,0.7024082328976883,0.7024082328976883,-0.7117743142018731,-0.13279340213080146,0.3236185514586589],[0.6498012654923547,0.7601041477090716,-0.7601041477090716,0.6498012654923547,0.5501326871940493,-0.3121746891941291],[0.9742583993189415,-0.2254341840903763,-0.2254341840903763,-0.9742583993189415,0.19606207165721917,0.763314573932615],[0.9898369593720455,-0.14220686995044646,0.14220686995044646,0.9898369593720455,0.024390590006443807,-0.1538277218580305],[0.943683760549974,-0.33084884777532336,-0.33084884777532336,-0.943683760549974,0.2980553541540718,0.6235888428248944],[0.9682896711666551,-0.24983016773794742,0.24983016773794742,0.9682896711666551,0.026904932129638,-0.26921490771398016],[0.7844664306244846,0.6201712821658871,0.6201712821658871,-0.7844664306244846,-0.07700715853734266,0.2225818274331878],[0.7291897866451842,0.6843115190118829,-0.6843115190118829,0.7291897866451842,0.5321263775700671,-0.4842260839045333],[0.9964152613238628,-0.08459684982845418,-0.08459684982845418,-0.9964152613238628,0.03950284222454179,0.9322342054422201],[1,0,0,1,0,0],[0.6046532467009014,0.796488826823113,0.796488826823113,-0.6046532467009014,-0.22348266493696245,0.45024132391515437],[0.5351052771490041,0.8447853824299324,-0.8447853824299324,0.5351052771490041,0.5429169854850711,-0.0819735426315153],[0.5137209499980594,0.8579573331658698,0.8579573331658698,-0.5137209499980594,-0.30274193011267186,0.5341370536031103],[0.43929890696680474,0.8983409543919112,-0.8983409543919112,0.43929890696680474,0.5173686803097546,0.08912056513008682],[0.9996846051330555,0.025113547339364273,0.025113547339364273,-0.9996846051330555,-0.09416390258549179,1.0420481887957034],[0.9939764700721684,0.10959369025118071,-0.10959369025118071,0.9939764700721684,-0.031261811504869674,0.11110006173491493]]
	}],
	"frame_author":"",
	"frame_title":"",
	"frame_description":"",
	"frame_attributes":[],
	"frame_classes":[],
	"frame_unit":"unit",
	"vertices_coords":[[0,0],[1,0],[1,1],[0,1],[1,0.5993937260559605],[0,0.18905444997844145],[0,0.04146401643552436],[1,0.31084546208354025],[1,0.9196506045389439],[0,0.35286361968088953],[0.8885354892769589,1],[0,0.4297904801400756],[0,0.2805848084879592],[1,0.7769467661013314],[0.08530176529538191,0],[1,0.19326725678467693],[1,0.4319576808233637],[0,0.10273950294267598],[0.6138529420121421,0.44094242182175913],[0.43113206429286094,0.24467601557511115],[0.6218464963376685,0.20897792459011916],[0.7458950166981522,0],[0.474869882136986,0.08231213138512597],[0.34593777499424727,0.45229515969651807],[0.45660877606475436,0.6116635311263582],[0.48084412342513727,1],[0.26302350131464436,0.5985834053596903]],
	"vertices_vertices":[[14,6],[15,21],[10,8],[11,25],[16,13,18],[12,17,18],[17,0,20],[15,16,20],[13,2,24],[11,12,24],[2,25,26],[3,9,26],[9,5,23],[4,8,23],[0,21,22],[1,7,22],[7,4,19],[5,6,19],[4,5,19,23],[16,17,18,20],[6,7,19,22],[14,1,22],[14,15,21,20],[12,13,18,24],[8,9,23,26],[10,3,26],[10,11,25,24]],
	"vertices_faces":[[6],[4],[14],[12],[8,1],[9,0],[3,6],[2,7],[11,14],[10,15],[14,13],[15,12],[10,9],[11,8],[6,5],[7,4],[2,1],[3,0],[8,9,0,1],[2,3,0,1],[2,3,6,7],[4,5],[6,7,4,5],[10,11,8,9],[10,11,14,15],[12,13],[14,15,12,13]],
	"edges_vertices":[[6,0],[8,2],[2,10],[3,11],[11,9],[9,12],[12,5],[4,13],[13,8],[0,14],[1,15],[15,7],[7,16],[16,4],[5,17],[17,6],[4,18],[18,5],[16,19],[19,17],[18,19],[6,20],[20,7],[19,20],[14,21],[21,1],[14,22],[22,15],[21,22],[22,20],[12,23],[23,13],[18,23],[8,24],[24,9],[23,24],[10,25],[25,3],[10,26],[26,11],[25,26],[26,24]],
	"edges_faces":[[6],[14],[14],[12],[15],[10],[9],[8],[11],[6],[4],[7],[2],[1],[0],[3],[8,1],[9,0],[2,1],[3,0],[0,1],[3,6],[2,7],[2,3],[5],[4],[6,5],[7,4],[4,5],[6,7],[10,9],[11,8],[8,9],[11,14],[10,15],[10,11],[13],[12],[14,13],[15,12],[12,13],[14,15]],
	"edges_assignment":["B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","V","V","V","V","M","M","M","V","B","B","M","M","V","M","M","M","V","V","V","M","B","B","V","V","M","V"],
	"edges_foldAngle":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,180,180,180,180,-180,-180,-180,180,0,0,-180,-180,180,-180,-180,-180,180,180,180,-180,0,0,180,180,-180,180],
	"edges_length":[0.04146401643552436,0.08034939546105613,0.11146451072304109,0.5702095198599244,0.07692686045918606,0.07227881119293034,0.09153035850951774,0.17755304004537087,0.14270383843761247,0.08530176529538191,0.19326725678467693,0.11757820529886331,0.12111221873982347,0.1674360452325968,0.08631494703576548,0.061275486507151616,0.4173923408571335,0.6635231606932063,0.5989032897003157,0.4538951756514724,0.26815559172890424,0.6440139551536598,0.39163384369468185,0.19402666901780874,0.6605932514027703,0.25410498330184783,0.3981690653889073,0.5367240264225676,0.2832488491363389,0.19402666901780893,0.3862089963739026,0.7302027524740657,0.2681555917289056,0.6246039222091819,0.5248513775761052,0.19402666901781224,0.40769136585182164,0.48084412342513727,0.7432365232798974,0.31252586108674146,0.45670680514880097,0.19402666901781163],
	"faces_vertices":[[18,5,17,19],[19,16,4,18],[20,7,16,19],[19,17,6,20],[21,1,15,22],[22,14,21],[20,6,0,14,22],[22,15,7,20],[18,4,13,23],[23,12,5,18],[24,9,12,23],[23,13,8,24],[25,3,11,26],[26,10,25],[24,8,2,10,26],[26,11,9,24]],
	"faces_edges":[[17,14,19,20],[18,13,16,20],[22,12,18,23],[19,15,21,23],[25,10,27,28],[26,24,28],[21,0,9,26,29],[27,11,22,29],[16,7,31,32],[30,6,17,32],[34,5,30,35],[31,8,33,35],[37,3,39,40],[38,36,40],[33,1,2,38,41],[39,4,34,41]],
	"faces_re:layer":[1,14,9,6,13,2,5,10,15,0,7,8,3,12,11,4],
	"face_re:stationary":9,
	"faces_re:to_move":[],
	"faces_re:preindex":[7,7,6,6,5,5,4,4,3,3,2,2,1,1,0,0],
	"faces_re:coloring":[false,true,false,true,false,true,false,true,false,true,false,true,false,true,false,true],
	"faces_re:creases":[],
	"faces_re:center":[
		[0.26124625157625075,0.24435309757949691],
		[0.7612462515762507,0.4292424610690486],
		[0.7632446401576324,0.2991142707680336],
		[0.2632446401576324,0.14946436488585768],
		[0.8051912247087846,0.06889484704245072],
		[0.43535555471017334,0.027437377128375323],
		[0.2364036287540073,0.0665508144821539],
		[0.7741790946186636,0.19885069371086556],
		[0.7399476792515973,0.5673945184188923],
		[0.23994767925159732,0.34071920999616945],
		[0.20063663776475038,0.42435177974793126],
		[0.7006366377647504,0.6901390153657878],
		[0.18596690618494538,0.7570934713749415],
		[0.5441343713389135,0.8661944684532301],
		[0.7216335533312715,0.8259795082049985],
		[0.17990806934484965,0.4982252590767534]
	],
	"faces_re:sidedness":[false,true,true,false,true,false,false,true,true,false,false,true,false,true,true,false]
};

let origami = RabbitEar.origami(fold);
origami.frame = 1;
origami.drawLayer = RabbitEar.svg.g();
origami.appendChild(origami.drawLayer);
let cpView = RabbitEar.origami(fold);
cpView.frame = 0;
cpView.drawLayer = RabbitEar.svg.g();
cpView.appendChild(cpView.drawLayer);

origami.onMouseMove = function(mouse) {
	origami.drawLayer.removeChildren();
	cpView.drawLayer.removeChildren();
	let faces = cpView.faces
	faces.forEach(f => f.svg.setAttribute("style", ""));

	let faces_containing = RabbitEar.core.folded_faces_containing_point(origami.cp, mouse, fold.file_frames[0]["faces_re:matrix"]);
	let top_face = RabbitEar.core.topmost_face(origami.cp, faces_containing);

	let mouseVec = RabbitEar.vector(mouse.x, mouse.y);
	let circles = fold.file_frames[0]["faces_re:matrix"]
		.map(m => mouseVec.transform(m))
		.map(p => cpView.drawLayer.circle(p[0], p[1], 0.01));

	faces_containing.forEach(f => faces[f].svg.setAttribute("style", "fill: #e14929"));

	if (top_face != null) {
		faces[top_face].svg.setAttribute("style", "fill: #ecb233");
		circles[top_face].setAttribute("style", "fill: #e14929");
		// dot on folded canvas
		let p = RabbitEar.math.multiply_matrix2_vector2(fold.file_frames[0]["faces_re:matrix"][top_face], mouse);
		origami.drawLayer.circle(p[0], p[1], 0.01);
	}
}
